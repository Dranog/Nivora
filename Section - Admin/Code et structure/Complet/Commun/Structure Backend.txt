apps/api/src/
â”‚
â”œâ”€â”€ modules/
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                                      # MODULE ADMIN PRINCIPAL
â”‚   â”‚   â”œâ”€â”€ admin.module.ts                         # âœ¨ Module principal qui importe tous les sous-modules
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                                   # ðŸ†• SOUS-MODULE CORE (Dashboard, Users, Settings)
â”‚   â”‚   â”‚   â”œâ”€â”€ core.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.controller.ts         # GET /admin/dashboard/metrics, /stats
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users.controller.ts             # CRUD users + suspend/unsuspend/delete
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.controller.ts          # GET/PATCH /admin/settings
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audit-log.controller.ts         # GET /admin/audit-log, /export
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.service.ts            # Calcul mÃ©triques, charts, recent activity
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ users.service.ts                # CRUD, suspend, statistics, export
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ settings.service.ts             # Get/Update platform settings
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ audit-log.service.ts            # Logging avec blockchain hash
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ audit-log-query.service.ts      # Query & Export audit logs
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ dashboard.dto.ts                # GetMetrics, GetStats schemas
â”‚   â”‚   â”‚       â”œâ”€â”€ users.dto.ts                    # GetUsers, UpdateUser, SuspendUser schemas
â”‚   â”‚   â”‚       â”œâ”€â”€ settings.dto.ts                 # UpdateSettings schema
â”‚   â”‚   â”‚       â””â”€â”€ audit-log.dto.ts                # GetAuditLog, ExportAuditLog schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ moderation/                             # ðŸ†• SOUS-MODULE MODÃ‰RATION
â”‚   â”‚   â”‚   â”œâ”€â”€ moderation.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ reports.controller.ts           # GET /admin/reports, PATCH /:id, POST /:id/assign
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ moderation.controller.ts        # GET /admin/moderation/queue, POST /decision
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ reports.service.ts              # Filtres, update, assign, actions (ban, delete)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ moderation.service.ts           # Queue, AI analysis, decisions
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ reports.dto.ts                  # GetReports, UpdateReport schemas
â”‚   â”‚   â”‚       â””â”€â”€ moderation.dto.ts               # GetQueue, MakeDecision schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ finance/                                # ðŸ†• SOUS-MODULE FINANCE
â”‚   â”‚   â”‚   â”œâ”€â”€ finance.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ transactions.controller.ts      # GET /admin/transactions, /trends, POST /:id/refund
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ accounting.controller.ts        # GET /summary, POST /export, GET /exports, /exports/:id/download
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ transactions.service.ts         # List, trends, refund, summary
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ accounting.service.ts           # Summary, export (CSV/PDF/XLSX), export history
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â”œâ”€â”€ transactions.dto.ts             # GetTransactions, RefundTransaction schemas
â”‚   â”‚   â”‚       â””â”€â”€ accounting.dto.ts               # GetSummary, ExportData schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ kyc/                                    # ðŸ†• SOUS-MODULE KYC
â”‚   â”‚   â”‚   â”œâ”€â”€ kyc.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ kyc.controller.ts               # GET /pending, /:id, POST /:id/approve, /:id/reject, /webhook
â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ kyc.service.ts                  # Get pending, approve, reject, webhook handler
â”‚   â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚   â”‚       â””â”€â”€ kyc.dto.ts                      # GetKyc, ApproveKyc, RejectKyc schemas
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ guards/                                 # âœ¨ GUARDS CENTRALISÃ‰S
â”‚   â”‚   â”‚   â”œâ”€â”€ admin-role.guard.ts                 # VÃ©rifie role = ADMIN ou MODERATOR
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.guard.ts                # VÃ©rifie permissions granulaires
â”‚   â”‚   â”‚   â””â”€â”€ resource-ownership.guard.ts         # VÃ©rifie ownership de ressources
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ decorators/                             # âœ¨ DECORATORS PERSONNALISÃ‰S
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.decorator.ts                  # @Admin() - Combine JWT + Role guard
â”‚   â”‚   â”‚   â”œâ”€â”€ audit-log.decorator.ts              # @AuditLog('action') - Log automatique
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.decorator.ts            # @RequirePermission('users.write')
â”‚   â”‚   â”‚   â””â”€â”€ current-admin.decorator.ts          # @CurrentAdmin() - Injecte admin actuel
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ interceptors/                           # ðŸ†• INTERCEPTORS
â”‚   â”‚   â”‚   â”œâ”€â”€ audit-log.interceptor.ts            # Interceptor pour @AuditLog decorator
â”‚   â”‚   â”‚   â”œâ”€â”€ cache.interceptor.ts                # Cache responses avec Redis
â”‚   â”‚   â”‚   â””â”€â”€ transform.interceptor.ts            # Transforme responses en format standard
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ gateways/
â”‚   â”‚   â”‚   â””â”€â”€ moderation.gateway.ts               # WebSocket pour real-time updates
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ types/                                  # ðŸ†• TYPES PARTAGÃ‰S
â”‚   â”‚       â”œâ”€â”€ admin.types.ts                      # Admin, AdminUser, AdminStats types
â”‚   â”‚       â”œâ”€â”€ permissions.types.ts                # Permission, Role types
â”‚   â”‚       â””â”€â”€ events.types.ts                     # Event payloads types
â”‚   â”‚
â”‚   â”œâ”€â”€ integrations/                               # ðŸ”¥ MODULE INTÃ‰GRATIONS
â”‚   â”‚   â”œâ”€â”€ integrations.module.ts                  # Module global qui exporte tous les providers
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ai-moderation/                          # ðŸ†• MODULE AI MODÃ‰RATION
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-moderation.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-moderation.service.ts            # Abstraction qui combine providers
â”‚   â”‚   â”‚   â”œâ”€â”€ providers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ google-vision.provider.ts       # Google Vision API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ aws-rekognition.provider.ts     # AWS Rekognition API
â”‚   â”‚   â”‚   â””â”€â”€ interfaces/
â”‚   â”‚   â”‚       â””â”€â”€ moderation-result.interface.ts  # AIAnalysisResult interface
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ storage/                                # ðŸ†• MODULE STORAGE
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ storage.service.ts                  # Abstraction storage (strategy pattern)
â”‚   â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚   â”‚       â”œâ”€â”€ s3.provider.ts                  # AWS S3 implementation
â”‚   â”‚   â”‚       â””â”€â”€ cloudflare-r2.provider.ts       # Alternative: Cloudflare R2
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ email/                                  # ðŸ†• MODULE EMAIL
â”‚   â”‚   â”‚   â”œâ”€â”€ email.module.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ email.service.ts                    # Service abstrait
â”‚   â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ suspension.template.ts          # Template suspension email
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ kyc-approval.template.ts        # Template KYC approval
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ kyc-rejection.template.ts       # Template KYC rejection
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ password-reset.template.ts      # Template password reset
â”‚   â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚   â”‚       â”œâ”€â”€ sendgrid.provider.ts            # SendGrid implementation
â”‚   â”‚   â”‚       â””â”€â”€ resend.provider.ts              # Alternative: Resend.com
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ kyc-provider/                           # ðŸ†• MODULE KYC PROVIDER
â”‚   â”‚       â”œâ”€â”€ kyc-provider.module.ts
â”‚   â”‚       â”œâ”€â”€ kyc-provider.service.ts             # Service abstrait
â”‚   â”‚       â””â”€â”€ providers/
â”‚   â”‚           â”œâ”€â”€ yoti.provider.ts                # Yoti implementation
â”‚   â”‚           â””â”€â”€ jumio.provider.ts               # Alternative: Jumio
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                                   # âœ¨ MODULE DATABASE
â”‚   â”‚   â”œâ”€â”€ database.module.ts
â”‚   â”‚   â”œâ”€â”€ prisma.service.ts                       # Prisma client service
â”‚   â”‚   â””â”€â”€ repositories/                           # ðŸ†• PATTERN REPOSITORY
â”‚   â”‚       â”œâ”€â”€ base.repository.ts                  # Repository abstrait de base
â”‚   â”‚       â”œâ”€â”€ user.repository.ts                  # Queries users complexes
â”‚   â”‚       â”œâ”€â”€ report.repository.ts                # Queries reports complexes
â”‚   â”‚       â”œâ”€â”€ transaction.repository.ts           # Queries transactions complexes
â”‚   â”‚       â”œâ”€â”€ audit-log.repository.ts             # Queries audit log complexes
â”‚   â”‚       â””â”€â”€ kyc.repository.ts                   # Queries KYC complexes
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                                      # ðŸ†• MODULE CACHE
â”‚   â”‚   â”œâ”€â”€ cache.module.ts
â”‚   â”‚   â”œâ”€â”€ redis.service.ts                        # Redis client service
â”‚   â”‚   â””â”€â”€ strategies/
â”‚   â”‚       â”œâ”€â”€ dashboard.cache.ts                  # Cache strategy pour dashboard
â”‚   â”‚       â”œâ”€â”€ user.cache.ts                       # Cache strategy pour users
â”‚   â”‚       â””â”€â”€ cache.interface.ts                  # Interface cache strategy
â”‚   â”‚
â”‚   â””â”€â”€ events/                                     # ðŸ†• MODULE EVENTS (Event-Driven)
â”‚       â”œâ”€â”€ events.module.ts
â”‚       â”œâ”€â”€ event-emitter.service.ts                # Service pour Ã©mettre events
â”‚       â””â”€â”€ listeners/
â”‚           â”œâ”€â”€ user-suspended.listener.ts          # Ã‰coute event user.suspended
â”‚           â”œâ”€â”€ user-unsuspended.listener.ts        # Ã‰coute event user.unsuspended
â”‚           â”œâ”€â”€ kyc-approved.listener.ts            # Ã‰coute event kyc.approved
â”‚           â”œâ”€â”€ kyc-rejected.listener.ts            # Ã‰coute event kyc.rejected
â”‚           â”œâ”€â”€ report-created.listener.ts          # Ã‰coute event report.created
â”‚           â””â”€â”€ export-completed.listener.ts        # Ã‰coute event export.completed
â”‚
â”œâ”€â”€ common/                                         # ðŸ”¥ MODULE COMMON AMÃ‰LIORÃ‰
â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts                       # âœ… JWT authentication
â”‚   â”‚   â”œâ”€â”€ rate-limit.guard.ts                     # âœ… Rate limiting global
â”‚   â”‚   â””â”€â”€ throttle.guard.ts                       # ðŸ†• Throttling spÃ©cifique
â”‚   â”‚
â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”œâ”€â”€ logging.interceptor.ts                  # âœ… Log toutes les requÃªtes
â”‚   â”‚   â”œâ”€â”€ transform-response.interceptor.ts       # ðŸ†• Format standard responses
â”‚   â”‚   â”œâ”€â”€ timeout.interceptor.ts                  # ðŸ†• Timeout automatique
â”‚   â”‚   â””â”€â”€ error-handling.interceptor.ts           # ðŸ†• Gestion erreurs globale
â”‚   â”‚
â”‚   â”œâ”€â”€ filters/                                    # ðŸ†• EXCEPTION FILTERS
â”‚   â”‚   â”œâ”€â”€ http-exception.filter.ts                # Filtre HttpException
â”‚   â”‚   â”œâ”€â”€ prisma-exception.filter.ts              # Filtre erreurs Prisma
â”‚   â”‚   â”œâ”€â”€ validation-exception.filter.ts          # Filtre erreurs validation
â”‚   â”‚   â””â”€â”€ all-exceptions.filter.ts                # Filtre catch-all
â”‚   â”‚
â”‚   â”œâ”€â”€ pipes/
â”‚   â”‚   â”œâ”€â”€ zod-validation.pipe.ts                  # âœ… Validation Zod
â”‚   â”‚   â”œâ”€â”€ parse-int.pipe.ts                       # ðŸ†• Parse int avec validation
â”‚   â”‚   â””â”€â”€ trim-string.pipe.ts                     # ðŸ†• Trim strings automatique
â”‚   â”‚
â”‚   â”œâ”€â”€ decorators/
â”‚   â”‚   â”œâ”€â”€ api-paginated-response.decorator.ts     # ðŸ†• Swagger pagination
â”‚   â”‚   â”œâ”€â”€ public.decorator.ts                     # ðŸ†• Route publique (skip auth)
â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts               # ðŸ†• Injecte user actuel
â”‚   â”‚   â””â”€â”€ cache-result.decorator.ts               # ðŸ†• Cache result avec TTL
â”‚   â”‚
â”‚   â”œâ”€â”€ dto/                                        # ðŸ†• DTOs COMMUNS
â”‚   â”‚   â”œâ”€â”€ pagination.dto.ts                       # PaginationDto (cursor, limit)
â”‚   â”‚   â”œâ”€â”€ filter.dto.ts                           # FilterDto (search, sort, order)
â”‚   â”‚   â”œâ”€â”€ response.dto.ts                         # StandardResponse<T>
â”‚   â”‚   â””â”€â”€ error-response.dto.ts                   # ErrorResponse
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                                      # ðŸ†• UTILITIES
â”‚   â”‚   â”œâ”€â”€ date.util.ts                            # Date helpers
â”‚   â”‚   â”œâ”€â”€ crypto.util.ts                          # Hash, encrypt, decrypt
â”‚   â”‚   â”œâ”€â”€ pagination.util.ts                      # Pagination helpers
â”‚   â”‚   â”œâ”€â”€ validation.util.ts                      # Validation helpers
â”‚   â”‚   â””â”€â”€ transform.util.ts                       # Transform data helpers
â”‚   â”‚
â”‚   â””â”€â”€ constants/                                  # ðŸ†• CONSTANTES
â”‚       â”œâ”€â”€ errors.constants.ts                     # Error codes & messages
â”‚       â”œâ”€â”€ permissions.constants.ts                # Liste permissions
â”‚       â”œâ”€â”€ cache-keys.constants.ts                 # Cache keys patterns
â”‚       â””â”€â”€ regex.constants.ts                      # Regex patterns
â”‚
â”œâ”€â”€ config/                                         # ðŸ†• MODULE CONFIGURATION
â”‚   â”œâ”€â”€ config.module.ts                            # Module configuration
â”‚   â”œâ”€â”€ configuration.ts                            # Configuration factory
â”‚   â”œâ”€â”€ database.config.ts                          # Database config
â”‚   â”œâ”€â”€ redis.config.ts                             # Redis config
â”‚   â”œâ”€â”€ aws.config.ts                               # AWS config
â”‚   â”œâ”€â”€ email.config.ts                             # Email config
â”‚   â”œâ”€â”€ kyc.config.ts                               # KYC config
â”‚   â””â”€â”€ validation-schema.ts                        # Joi validation schema pour env vars
â”‚
â”œâ”€â”€ health/                                         # ðŸ†• MODULE HEALTH CHECKS
â”‚   â”œâ”€â”€ health.module.ts
â”‚   â”œâ”€â”€ health.controller.ts                        # GET /health, /health/live, /health/ready
â”‚   â””â”€â”€ indicators/
â”‚       â”œâ”€â”€ database.indicator.ts                   # Check database connection
â”‚       â”œâ”€â”€ redis.indicator.ts                      # Check Redis connection
â”‚       â”œâ”€â”€ s3.indicator.ts                         # Check S3 connection
â”‚       â””â”€â”€ external-apis.indicator.ts              # Check external APIs (Yoti, etc.)
â”‚
â”œâ”€â”€ app.module.ts                                   # âœ¨ Module principal
â””â”€â”€ main.ts                                         # âœ¨ Bootstrap application